import{c3 as A,c4 as st,c5 as it,c6 as ot,c7 as ct,c8 as C,c9 as ve,ca as _e,cb as Te,cc as L,cd as ut,ce as me,cf as ae,cg as v,ch as O,ci as re,cj as ge,ck as dt,cl as lt,cm as se,cn as pt,co as Ee,cp as Ie,cq as G,cr as ft,cs as yt,ct as _,cu as J,cv as mt,cw as Oe,cx as Le,cy as gt,cz as ht,cA as Q,cB as q,cC as F,cD as Pt,cE as bt,cF as wt,cG as De,cH as xt,cI as At,cJ as $,cK as Fe,v as P,cL as z,cM as ie,cN as Be,cO as V,cP as Gt,cQ as M,cR as vt,cS as I,cT as x,cU as T,cV as R,cW as oe,cX as _t,cY as Se,cZ as Tt,c_ as Et,c$ as Ue,d0 as D,d1 as It,d2 as Ot,d3 as Lt,d4 as Dt,d5 as Ft}from"./index-3b8711e5.js";async function Bt(e){const t=await e({method:"eth_gasPrice"});return A(t)}function St(e){const t=[],n=e.length;for(let a=0;a<n;a++){const r=e[a],s=st(r);t.push(s)}return t}function Ut(e){const t=it(e),n=[],a=e.length;for(let r=0;r<a;r++){const s=e[r];ot(s)||n.push(ct(s,t))}return n}class Ct extends C{constructor(t){super(`Filter type "${t}" is not supported.`,{name:"FilterTypeNotSupportedError"})}}const W=ve;function Vt(e){const{abi:t,args:n=[],name:a}=e,r=_e(a,{strict:!1}),s=t.filter(o=>r?o.type==="function"?Te(o)===a:o.type==="event"?W(o)===a:!1:"name"in o&&o.name===a);if(s.length===0)return;if(s.length===1)return s[0];let i;for(const o of s){if(!("inputs"in o))continue;if(!n||n.length===0){if(!o.inputs||o.inputs.length===0)return o;continue}if(!o.inputs||o.inputs.length===0||o.inputs.length!==n.length)continue;if(n.every((c,d)=>{const p="inputs"in o&&o.inputs[d];return p?ee(c,p):!1})){if(i&&"inputs"in i&&i.inputs){const c=Ce(o.inputs,i.inputs,n);if(c)throw new ut({abiItem:o,type:c[0]},{abiItem:i,type:c[1]})}i=o}}return i||s[0]}function ee(e,t){const n=typeof e,a=t.type;switch(a){case"address":return L(e,{strict:!1});case"bool":return n==="boolean";case"function":return n==="string";case"string":return n==="string";default:return a==="tuple"&&"components"in t?Object.values(t.components).every((r,s)=>ee(Object.values(e)[s],r)):/^u?int(8|16|24|32|40|48|56|64|72|80|88|96|104|112|120|128|136|144|152|160|168|176|184|192|200|208|216|224|232|240|248|256)?$/.test(a)?n==="number"||n==="bigint":/^bytes([1-9]|1[0-9]|2[0-9]|3[0-2])?$/.test(a)?n==="string"||e instanceof Uint8Array:/[a-z]+[1-9]{0,3}(\[[0-9]{0,}\])+$/.test(a)?Array.isArray(e)&&e.every(r=>ee(r,{...t,type:a.replace(/(\[[0-9]{0,}\])$/,"")})):!1}}function Ce(e,t,n){for(const a in e){const r=e[a],s=t[a];if(r.type==="tuple"&&s.type==="tuple"&&"components"in r&&"components"in s)return Ce(r.components,s.components,n[a]);const i=[r.type,s.type];if((()=>i.includes("address")&&i.includes("bytes20")?!0:i.includes("address")&&i.includes("string")?L(n[a],{strict:!1}):i.includes("address")&&i.includes("bytes")?L(n[a],{strict:!1}):!1)())return i}}const he="/docs/contract/encodeEventTopics";function Mt(e){var u;const{abi:t,eventName:n,args:a}=e;let r=t[0];if(n){const c=Vt({abi:t,name:n});if(!c)throw new me(n,{docsPath:he});r=c}if(r.type!=="event")throw new me(void 0,{docsPath:he});const s=ae(r),i=W(s);let o=[];if(a&&"inputs"in r){const c=(u=r.inputs)==null?void 0:u.filter(p=>"indexed"in p&&p.indexed),d=Array.isArray(a)?a:Object.values(a).length>0?(c==null?void 0:c.map(p=>a[p.name]))??[]:[];d.length>0&&(o=(c==null?void 0:c.map((p,y)=>Array.isArray(d[y])?d[y].map((m,g)=>Pe({param:p,value:d[y][g]})):d[y]?Pe({param:p,value:d[y]}):null))??[])}return[i,...o]}function Pe({param:e,value:t}){if(e.type==="string"||e.type==="bytes")return v(O(t));if(e.type==="tuple"||e.type.match(/^(.*)\[(\d+)?\]$/))throw new Ct(e.type);return re([e],[t])}const Rt={inputs:[{name:"message",type:"string"}],name:"Error",type:"error"},$t={inputs:[{name:"reason",type:"uint256"}],name:"Panic",type:"error"};function Ve(e){const{abi:t,data:n}=e,a=ge(n,0,4);if(a==="0x")throw new dt;const s=[...t||[],Rt,$t].find(i=>i.type==="error"&&a===Te(ae(i)));if(!s)throw new lt(a,{docsPath:"/docs/contract/decodeErrorResult"});return{abiItem:s,args:"inputs"in s&&s.inputs&&s.inputs.length>0?se(s.inputs,ge(n,4)):void 0,errorName:s.name}}function Nt(e,t="hex"){const n=Me(e),a=pt(new Uint8Array(n.length));return n.encode(a),t==="hex"?Ee(a.bytes):a.bytes}function Me(e){return Array.isArray(e)?Ht(e.map(t=>Me(t))):jt(e)}function Ht(e){const t=e.reduce((r,s)=>r+s.length,0),n=Re(t);return{length:(()=>t<=55?1+t:1+n+t)(),encode(r){t<=55?r.pushByte(192+t):(r.pushByte(192+55+n),n===1?r.pushUint8(t):n===2?r.pushUint16(t):n===3?r.pushUint24(t):r.pushUint32(t));for(const{encode:s}of e)s(r)}}}function jt(e){const t=typeof e=="string"?Ie(e):e,n=Re(t.length);return{length:(()=>t.length===1&&t[0]<128?1:t.length<=55?1+t.length:1+n+t.length)(),encode(r){t.length===1&&t[0]<128?r.pushBytes(t):t.length<=55?(r.pushByte(128+t.length),r.pushBytes(t)):(r.pushByte(128+55+n),n===1?r.pushUint8(t.length):n===2?r.pushUint16(t.length):n===3?r.pushUint24(t.length):r.pushUint32(t.length),r.pushBytes(t))}}}function Re(e){if(e<2**8)return 1;if(e<2**16)return 2;if(e<2**24)return 3;if(e<2**32)return 4;throw new C("Length is too large.")}const zt={legacy:"0x0",eip2930:"0x1",eip1559:"0x2",eip4844:"0x3",eip7702:"0x4"};function Wt(e){const t={};return typeof e.authorizationList<"u"&&(t.authorizationList=kt(e.authorizationList)),typeof e.accessList<"u"&&(t.accessList=e.accessList),typeof e.blobVersionedHashes<"u"&&(t.blobVersionedHashes=e.blobVersionedHashes),typeof e.blobs<"u"&&(typeof e.blobs[0]!="string"?t.blobs=e.blobs.map(n=>Ee(n)):t.blobs=e.blobs),typeof e.data<"u"&&(t.data=e.data),typeof e.from<"u"&&(t.from=e.from),typeof e.gas<"u"&&(t.gas=G(e.gas)),typeof e.gasPrice<"u"&&(t.gasPrice=G(e.gasPrice)),typeof e.maxFeePerBlobGas<"u"&&(t.maxFeePerBlobGas=G(e.maxFeePerBlobGas)),typeof e.maxFeePerGas<"u"&&(t.maxFeePerGas=G(e.maxFeePerGas)),typeof e.maxPriorityFeePerGas<"u"&&(t.maxPriorityFeePerGas=G(e.maxPriorityFeePerGas)),typeof e.nonce<"u"&&(t.nonce=G(e.nonce)),typeof e.to<"u"&&(t.to=e.to),typeof e.type<"u"&&(t.type=zt[e.type]),typeof e.value<"u"&&(t.value=G(e.value)),t}function kt(e){return e.map(t=>({address:t.contractAddress,r:t.r,s:t.s,chainId:G(t.chainId),nonce:G(t.nonce),...typeof t.yParity<"u"?{yParity:G(t.yParity)}:{},...typeof t.v<"u"&&typeof t.yParity>"u"?{v:G(t.v)}:{}}))}const Zt=2n**16n-1n,Yt=2n**96n-1n;function Xt(e){var n;const t=(n=e.transactions)==null?void 0:n.map(a=>typeof a=="string"?a:ft(a));return{...e,baseFeePerGas:e.baseFeePerGas?BigInt(e.baseFeePerGas):null,blobGasUsed:e.blobGasUsed?BigInt(e.blobGasUsed):void 0,difficulty:e.difficulty?BigInt(e.difficulty):void 0,excessBlobGas:e.excessBlobGas?BigInt(e.excessBlobGas):void 0,gasLimit:e.gasLimit?BigInt(e.gasLimit):void 0,gasUsed:e.gasUsed?BigInt(e.gasUsed):void 0,hash:e.hash?e.hash:null,logsBloom:e.logsBloom?e.logsBloom:null,nonce:e.nonce?e.nonce:null,number:e.number?BigInt(e.number):null,size:e.size?BigInt(e.size):void 0,timestamp:e.timestamp?BigInt(e.timestamp):void 0,transactions:t,totalDifficulty:e.totalDifficulty?BigInt(e.totalDifficulty):null}}function Kt(e,t){const n=t||"hex",a=yt(_e(e,{strict:!1})?O(e):e);return n==="bytes"?a:_(a)}function Jt(e,t){if(!L(e,{strict:!1}))throw new J({address:e});if(!L(t,{strict:!1}))throw new J({address:t});return e.toLowerCase()===t.toLowerCase()}const be="/docs/contract/decodeEventLog";function Qt(e){const{abi:t,data:n,strict:a,topics:r}=e,s=a??!0,[i,...o]=r;if(!i)throw new mt({docsPath:be});const u=(()=>t.length===1?t[0]:t.find(f=>f.type==="event"&&i===W(ae(f))))();if(!(u&&"name"in u)||u.type!=="event")throw new Oe(i,{docsPath:be});const{name:c,inputs:d}=u,p=d==null?void 0:d.some(f=>!("name"in f&&f.name));let y=p?[]:{};const m=d.filter(f=>"indexed"in f&&f.indexed);for(let f=0;f<m.length;f++){const l=m[f],h=o[f];if(!h)throw new Le({abiItem:u,param:l});y[p?f:l.name||f]=qt({param:l,value:h})}const g=d.filter(f=>!("indexed"in f&&f.indexed));if(g.length>0){if(n&&n!=="0x")try{const f=se(g,n);if(f)if(p)y=[...y,...f];else for(let l=0;l<g.length;l++)y[g[l].name]=f[l]}catch(f){if(s)throw f instanceof gt||f instanceof ht?new Q({abiItem:u,data:n,params:g,size:q(n)}):f}else if(s)throw new Q({abiItem:u,data:"0x",params:g,size:0})}return{eventName:c,args:Object.values(y).length>0?y:void 0}}function qt({param:e,value:t}){return e.type==="string"||e.type==="bytes"||e.type==="tuple"||e.type.match(/^(.*)\[(\d+)?\]$/)?t:(se([e],t)||[])[0]}function en(e){const{abi:t,args:n,logs:a,strict:r=!0}=e,s=(()=>{if(e.eventName)return Array.isArray(e.eventName)?e.eventName:[e.eventName]})();return a.map(i=>{var o;try{const u=t.find(d=>d.type==="event"&&i.topics[0]===W(d));if(!u)return null;const c=Qt({...i,abi:[u],strict:r});return s&&!s.includes(c.eventName)||!tn({args:c.args,inputs:u.inputs,matchArgs:n})?null:{...c,...i}}catch(u){let c,d;if(u instanceof Oe)return null;if(u instanceof Q||u instanceof Le){if(r)return null;c=u.abiItem.name,d=(o=u.abiItem.inputs)==null?void 0:o.some(p=>!("name"in p&&p.name))}return{...i,args:d?[]:{},eventName:c}}}).filter(Boolean)}function tn(e){const{args:t,inputs:n,matchArgs:a}=e;if(!a)return!0;if(!t)return!1;function r(s,i,o){try{return s.type==="address"?Jt(i,o):s.type==="string"||s.type==="bytes"?v(O(i))===o:i===o}catch{return!1}}return Array.isArray(t)&&Array.isArray(a)?a.every((s,i)=>{if(s===null)return!0;const o=n[i];return o?(Array.isArray(s)?s:[s]).some(c=>r(o,c,t[i])):!1}):typeof t=="object"&&!Array.isArray(t)&&typeof a=="object"&&!Array.isArray(a)?Object.entries(a).every(([s,i])=>{if(i===null)return!0;const o=n.find(c=>c.name===s);return o?(Array.isArray(i)?i:[i]).some(c=>r(o,c,t[s])):!1}):!1}function nn(e){const{domain:t={},message:n,primaryType:a}=e,r={EIP712Domain:cn({domain:t}),...e.types};on({domain:t,message:n,primaryType:a,types:r});const s=["0x1901"];return t&&s.push(an({domain:t,types:r})),a!=="EIP712Domain"&&s.push($e({data:n,primaryType:a,types:r})),v(F(s))}function an({domain:e,types:t}){return $e({data:e,primaryType:"EIP712Domain",types:t})}function $e({data:e,primaryType:t,types:n}){const a=Ne({data:e,primaryType:t,types:n});return v(a)}function Ne({data:e,primaryType:t,types:n}){const a=[{type:"bytes32"}],r=[rn({primaryType:t,types:n})];for(const s of n[t]){const[i,o]=je({types:n,name:s.name,type:s.type,value:e[s.name]});a.push(i),r.push(o)}return re(a,r)}function rn({primaryType:e,types:t}){const n=_(sn({primaryType:e,types:t}));return v(n)}function sn({primaryType:e,types:t}){let n="";const a=He({primaryType:e,types:t});a.delete(e);const r=[e,...Array.from(a).sort()];for(const s of r)n+=`${s}(${t[s].map(({name:i,type:o})=>`${o} ${i}`).join(",")})`;return n}function He({primaryType:e,types:t},n=new Set){const a=e.match(/^\w*/u),r=a==null?void 0:a[0];if(n.has(r)||t[r]===void 0)return n;n.add(r);for(const s of t[r])He({primaryType:s.type,types:t},n);return n}function je({types:e,name:t,type:n,value:a}){if(e[n]!==void 0)return[{type:"bytes32"},v(Ne({data:a,primaryType:n,types:e}))];if(n==="bytes")return a=`0x${(a.length%2?"0":"")+a.slice(2)}`,[{type:"bytes32"},v(a)];if(n==="string")return[{type:"bytes32"},v(_(a))];if(n.lastIndexOf("]")===n.length-1){const r=n.slice(0,n.lastIndexOf("[")),s=a.map(i=>je({name:t,type:r,types:e,value:i}));return[{type:"bytes32"},v(re(s.map(([i])=>i),s.map(([,i])=>i)))]}return[{type:n},a]}function on(e){const{domain:t,message:n,primaryType:a,types:r}=e,s=(i,o)=>{for(const u of i){const{name:c,type:d}=u,p=o[c],y=d.match(Pt);if(y&&(typeof p=="number"||typeof p=="bigint")){const[f,l,h]=y;G(p,{signed:l==="int",size:Number.parseInt(h)/8})}if(d==="address"&&typeof p=="string"&&!L(p))throw new J({address:p});const m=d.match(bt);if(m){const[f,l]=m;if(l&&q(p)!==Number.parseInt(l))throw new wt({expectedSize:Number.parseInt(l),givenSize:q(p)})}const g=r[d];g&&s(g,p)}};r.EIP712Domain&&t&&s(r.EIP712Domain,t),a!=="EIP712Domain"&&s(r[a],n)}function cn({domain:e}){return[typeof(e==null?void 0:e.name)=="string"&&{name:"name",type:"string"},(e==null?void 0:e.version)&&{name:"version",type:"string"},typeof(e==null?void 0:e.chainId)=="number"&&{name:"chainId",type:"uint256"},(e==null?void 0:e.verifyingContract)&&{name:"verifyingContract",type:"address"},(e==null?void 0:e.salt)&&{name:"salt",type:"bytes32"}].filter(Boolean)}async function un(e,t){const n=t.blockTag??"latest",a=t.includeTransactions??!1,r=t.blockNumber!==void 0?De(t.blockNumber):void 0,s=await e({method:"eth_getBlockByNumber",params:[r||n,a]});if(!s)throw new Error("Block not found");return Xt(s)}async function dn(e){const t=await e({method:"eth_maxPriorityFeePerGas"});return A(t)}async function ln(e,t){return await e({method:"eth_sendRawTransaction",params:[t]})}function ze(e,t){return t&&(e.__preparedMethod=t.preparedMethod,e.__contract=t.contract),e}const pn=Object.freeze(Object.defineProperty({__proto__:null,prepareTransaction:ze},Symbol.toStringTag,{value:"Module"}));async function w(e){return typeof e=="function"?await e():e}function k(e){const{contract:t,method:n,params:a,...r}=e,s=()=>(async()=>{var i,o;if(Array.isArray(n))return n;if(At(n))return $(n);if(typeof n=="function")return $(await n(t));if(typeof n=="string"&&n.startsWith("function ")){const u=Fe(n);if(u.type==="function")return $(u);throw new Error('"method" passed is not of type "function"')}if(t.abi&&((i=t.abi)==null?void 0:i.length)>0){const u=(o=t.abi)==null?void 0:o.find(c=>c.type==="function"&&c.name===n);if(u)return $(u)}throw new Error(`Could not resolve method "${n}".`)})();return ze({...r,to:t.address,chain:t.chain,client:t.client,data:async()=>{let i;return Array.isArray(n)?i=n:i=await s(),i[1].length===0?i[0]:i[0]+xt(i[1],await w(a??[])).slice(2)}},{preparedMethod:s,contract:t})}const fn="https://{clientId}.ipfscdn.io/ipfs/{cid}";function yn(e){var t,n;if(e.uri.startsWith("ipfs://")){const a=((n=(t=e.client.config)==null?void 0:t.storage)==null?void 0:n.gatewayUrl)??fn,r=e.client.clientId,s=mn(e.uri);let i;return typeof globalThis<"u"&&"Application"in globalThis&&(i=globalThis.Application.applicationId),`${a.replace("{clientId}",r).split("/ipfs")[0]}/ipfs/${s}${i?`?bundleId=${i}`:""}`}if(e.uri.startsWith("http"))return e.uri;throw new Error('Invalid URI scheme, expected "ipfs://" or "http(s)://"')}function mn(e){if(!e.startsWith("ipfs://"))return e;const t=e.search(/\/(Qm|baf)/i);return e.slice(t+1)}async function gn(e){var a,r,s,i,o,u,c,d,p,y;let t;if(e.uri.startsWith("ar://")){const{resolveArweaveScheme:m}=await P(()=>import("./arweave-b4cf678c.js"),[]);t=m(e)}else t=yn(e);const n=await z(e.client)(t,{keepalive:(s=(r=(a=e.client.config)==null?void 0:a.storage)==null?void 0:r.fetch)==null?void 0:s.keepalive,headers:(u=(o=(i=e.client.config)==null?void 0:i.storage)==null?void 0:o.fetch)==null?void 0:u.headers,requestTimeoutMs:e.requestTimeoutMs??((p=(d=(c=e.client.config)==null?void 0:c.storage)==null?void 0:d.fetch)==null?void 0:p.requestTimeoutMs)??6e4});if(!n.ok)throw(y=n.body)==null||y.cancel(),new Error(`Failed to download file: ${n.statusText}`);return n}const Y=new WeakMap;function hn(e,t="https://contract.thirdweb.com/abi"){if(Y.has(e))return Y.get(e);const n=(async()=>{if(e.abi)return e.abi;try{return await Pn(e,t)}catch{return await An(e)}})();return Y.set(e,n),n}async function Pn(e,t="https://contract.thirdweb.com/abi"){const a=await(await z(e.client)(`${t}/${e.chain.id}/${e.address}`)).json();if(!a||a.error)throw new Error(`Failed to resolve ABI from contract API. ${a.error||""}`);return a}async function We(e){const[{resolveImplementation:t},{extractIPFSUri:n}]=await Promise.all([P(()=>import("./resolveImplementation-42ddbd21.js"),["assets/resolveImplementation-42ddbd21.js","assets/index-3b8711e5.js","assets/index-e30b26c0.css"]),P(()=>import("./extractIPFS-13d1359c.js"),["assets/extractIPFS-13d1359c.js","assets/index-3b8711e5.js","assets/index-e30b26c0.css"])]),{bytecode:a}=await t(e);if(a==="0x"){const{id:s,name:i}=e.chain;throw new Error(`Failed to load contract bytecode. Make sure the contract [${e.address}] exists on the chain [${i||"Unknown Chain"} (chain id: ${s})]`)}const r=n(a);if(!r)return[];try{return(await(await gn({uri:r,client:e.client})).json()).output.abi}catch{return[]}}const bn={inputs:[],name:"getAllPlugins",outputs:[{components:[{internalType:"bytes4",name:"functionSelector",type:"bytes4"},{internalType:"string",name:"functionSignature",type:"string"},{internalType:"address",name:"pluginAddress",type:"address"}],internalType:"struct IPluginMap.Plugin[]",name:"registered",type:"tuple[]"}],stateMutability:"view",type:"function"},wn={inputs:[],name:"getAllExtensions",outputs:[{components:[{components:[{internalType:"string",name:"name",type:"string"},{internalType:"string",name:"metadataURI",type:"string"},{internalType:"address",name:"implementation",type:"address"}],internalType:"struct IExtension.ExtensionMetadata",name:"metadata",type:"tuple"},{components:[{internalType:"bytes4",name:"functionSelector",type:"bytes4"},{internalType:"string",name:"functionSignature",type:"string"}],internalType:"struct IExtension.ExtensionFunction[]",name:"functions",type:"tuple[]"}],internalType:"struct IExtension.Extension[]",name:"allExtensions",type:"tuple[]"}],stateMutability:"view",type:"function"},xn={inputs:[],name:"facets",outputs:[{components:[{internalType:"address",name:"facetAddress",type:"address"},{internalType:"bytes4[]",name:"functionSelectors",type:"bytes4[]"}],type:"tuple[]"}],stateMutability:"view",type:"function"};async function An(e,t,n){const[a,r,s,i,o]=await Promise.all([t||We(e),Gn(e),vn(e),_n(e),Tn(e)]),u=[...new Set([...r,...s,...i,...o])];if(!u.length)return a;const c=await En({contract:e,plugins:u,resolveSubAbi:n});return In({rootAbi:a,pluginAbis:c})}async function Gn(e){try{const{readContract:t}=await P(()=>import("./index-3b8711e5.js").then(a=>a.fX),["assets/index-3b8711e5.js","assets/index-e30b26c0.css"]),n=await t({contract:e,method:bn});return n.length?[...new Set(n.map(a=>a.pluginAddress))]:[]}catch{}return[]}async function vn(e){try{const{readContract:t}=await P(()=>import("./index-3b8711e5.js").then(a=>a.fX),["assets/index-3b8711e5.js","assets/index-e30b26c0.css"]),n=await t({contract:e,method:wn});return n.length?[...new Set(n.map(a=>a.metadata.implementation))]:[]}catch{}return[]}async function _n(e){try{const{getInstalledModules:t}=await P(()=>import("./getInstalledModules-50eddc0f.js"),["assets/getInstalledModules-50eddc0f.js","assets/index-3b8711e5.js","assets/index-e30b26c0.css","assets/detectExtension-c0bb3393.js"]),n=await t({contract:e});return n.length?[...new Set(n.map(a=>a.implementation))]:[]}catch{}return[]}async function Tn(e){try{const{readContract:t}=await P(()=>import("./index-3b8711e5.js").then(a=>a.fX),["assets/index-3b8711e5.js","assets/index-e30b26c0.css"]),n=await t({contract:e,method:xn});return n.length?n.map(a=>a.facetAddress):[]}catch{}return[]}async function En(e){return Promise.all(e.plugins.map(t=>{const n={...e.contract,address:t};return e.resolveSubAbi?e.resolveSubAbi(n):We(n)}))}function In(e){let t=e.pluginAbis.flat().filter(a=>a.type!=="constructor");e.rootAbi&&(t=[...e.rootAbi,...t].filter(a=>a.type!=="fallback"&&a.type!=="receive").filter(Boolean));const n=[...new Set(St(t))];return Ut(n)}const X=new WeakMap;async function B(e){if(X.has(e))return X.get(e);const t=(async()=>{const[n,a,{concatHex:r}]=await Promise.all([ke(e),Ze(e),P(()=>Promise.resolve().then(()=>Zn),void 0)]);return a?r([n,a]):n})();return X.set(e,t),t}async function ke(e){if(e.data===void 0)return"0x";if(typeof e.data=="function"){const t=await e.data();return t||"0x"}return e.data}async function Ze(e){if(e.extraCallData){if(typeof e.extraCallData=="function"){const t=await e.extraCallData();if(!t)return;if(!t.startsWith("0x"))throw Error("Invalid extra calldata - must be a hex string");return t==="0x"?void 0:t}if(!e.extraCallData.startsWith("0x"))throw Error("Invalid extra calldata - must be a hex string");return e.extraCallData}}const On=Object.freeze(Object.defineProperty({__proto__:null,encode:B,getDataFromTx:ke,getExtraCallDataFromTx:Ze},Symbol.toStringTag,{value:"Module"}));function U(e){if(e===0n||(e&e-1n)===0n)return e;let t=1n;for(;e>0n;)e>>=1n,t<<=1n;return t}async function we(e){const{error:t,contract:n}=e;if(typeof t=="object"){const a=t;if(a.data){if(a.data!=="0x"&&ie(a.data)){let r=n==null?void 0:n.abi;n&&!r&&(r=await hn(n).catch(()=>{}));const s=Ve({data:a.data,abi:r});return new xe(`${s.errorName}${s.args?` - ${s.args}`:""}`,n)}return new xe(`Execution Reverted: ${Be(a)}`,n)}}return t}class xe extends Error{constructor(t,n){var r;let a=t;super(a),Object.defineProperty(this,"contractAddress",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"chainId",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.name="TransactionError",this.contractAddress=n==null?void 0:n.address,this.chainId=(r=n==null?void 0:n.chain)==null?void 0:r.id,this.message=a}}const K=new WeakMap;async function Ln(e){var s;const t=e.from??((s=e.account)==null?void 0:s.address)??void 0,n={...e.transaction,from:t};if(K.has(n))return K.get(n);const{account:a}=e,r=(async()=>{var g,f;const i=await w(e.transaction.gas);if(i!==void 0)return i;if(a!=null&&a.estimateGas)try{let l=await a.estimateGas(e.transaction);return(g=e.transaction.chain.experimental)!=null&&g.increaseZeroByteCount&&(l=U(l)),l}catch(l){throw await we({error:l,contract:e.transaction.__contract})}const{encode:o}=await P(()=>Promise.resolve().then(()=>On),void 0),[u,c,d]=await Promise.all([o(e.transaction),w(e.transaction.to),w(e.transaction.value)]),[{getRpcClient:p},{eth_estimateGas:y}]=await Promise.all([P(()=>import("./index-3b8711e5.js").then(l=>l.fV),["assets/index-3b8711e5.js","assets/index-e30b26c0.css"]),P(()=>import("./eth_estimateGas-d306c28a.js"),["assets/eth_estimateGas-d306c28a.js","assets/index-3b8711e5.js","assets/index-e30b26c0.css"])]),m=p(e.transaction);try{let l=await y(m,Wt({to:c,data:u,from:t,value:d}));return(f=e.transaction.chain.experimental)!=null&&f.increaseZeroByteCount&&(l=U(l)),l}catch(l){throw await we({error:l,contract:e.transaction.__contract})}})();return K.set(n,r),r}async function Dn(e){const{client:t,chain:n,percentMultiplier:a}=e,r=V({client:t,chain:n}),s=await Bt(r),i=a?s/BigInt(100)*BigInt(a):0n;return s+i}function Ye(e,t){let[n,a=""]=e.split(".");const r=n.startsWith("-")?"-":"";if(r&&(n=n.slice(1)),a=a.padEnd(t,"0"),t===0)a[0]&&Number.parseInt(a[0])>=5&&(n=(BigInt(n)+1n).toString()),a="";else if(a.length>t){const s=a[t];s&&Number.parseInt(s,10)>=5?(a=(BigInt(a.substring(0,t))+1n).toString().padStart(t,"0"),a.length>t&&(n=(BigInt(n)+1n).toString(),a=a.substring(a.length-t))):a=a.substring(0,t)}return BigInt(`${r}${n}${a}`)}const Fn=[78600,2040,248,9372,841,842,2016,9768,2442];async function Bn(e){var s;const[t,n,a]=await Promise.all([w(e.maxFeePerGas),w(e.maxPriorityFeePerGas),w(e.gasPrice)]);if(t!==void 0&&n!==void 0)return{maxFeePerGas:t,maxPriorityFeePerGas:n};if(a)return{gasPrice:a};const r=await Xe(e.client,e.chain);return(s=e.chain.experimental)!=null&&s.increaseZeroByteCount?r.gasPrice?{gasPrice:U(r.gasPrice)}:{maxFeePerGas:t??U(r.maxFeePerGas??0n),maxPriorityFeePerGas:n??U(r.maxPriorityFeePerGas??0n)}:r.gasPrice?r:{maxFeePerGas:t??r.maxFeePerGas,maxPriorityFeePerGas:n??r.maxPriorityFeePerGas}}async function Xe(e,t){if(!Fn.includes(t.id)){const n=await Sn(e,t);if(n.maxFeePerGas!==null&&n.maxPriorityFeePerGas!==null)return{maxFeePerGas:n.maxFeePerGas,maxPriorityFeePerGas:n.maxPriorityFeePerGas}}return{gasPrice:await Dn({client:e,chain:t,percentMultiplier:10})}}async function Sn(e,t,n=10){let a=null,r=null;const s=V({client:e,chain:t}),[i,o]=await Promise.all([un(s,{blockTag:"latest"}),dn(s).catch(()=>null)]),u=(i==null?void 0:i.baseFeePerGas)??0n,c=t.id;return c===220||c===1220?{maxFeePerGas:null,maxPriorityFeePerGas:null}:(c===80002||c===137?r=await Mn(c):o!==null&&(r=o),r==null?{maxFeePerGas:null,maxPriorityFeePerGas:null}:(r=Un(r,n),a=u*2n+r,(c===42220||c===44787||c===62320)&&(r=a),{maxFeePerGas:a,maxPriorityFeePerGas:r}))}function Un(e,t=10){const n=e/BigInt(100)*BigInt(t);return e+n}function Cn(e){switch(e){case 137:return"https://gasstation.polygon.technology/v2";case 80002:return"https://gasstation-testnet.polygon.technology/v2"}}const Vn=31n;async function Mn(e){const t=Cn(e);try{const a=(await(await fetch(t)).json()).fast.maxPriorityFee;if(a>0){const r=Number.parseFloat(a).toFixed(9);return Ye(r,9)}}catch(n){console.error("failed to fetch gas",n)}return Vn}async function Ke(e){const t=V(e.transaction),n=e.transaction.chain.id,a=e.from;let[r,s,i,o,u,c,d]=await Promise.all([B(e.transaction),(async()=>{const y=await w(e.transaction.nonce);return y!==void 0?y:a?await P(()=>import("./eth_getTransactionCount-2a6db06c.js"),["assets/eth_getTransactionCount-2a6db06c.js","assets/index-3b8711e5.js","assets/index-e30b26c0.css"]).then(({eth_getTransactionCount:m})=>m(t,{address:a,blockTag:"pending"})):void 0})(),Ln(e),Bn(e.transaction),w(e.transaction.to),w(e.transaction.accessList),w(e.transaction.value)]);const p=await w(e.transaction.extraGas);return p&&(i+=p),{to:u,chainId:n,data:r,gas:i,nonce:s,accessList:c,value:d,...o}}function Rn(e){return!!(e&&typeof e=="object"&&"type"in e&&e.type==="event")}function Je(e){const{signature:t}=e;let n;return Rn(t)?n=t:n=Fe(t),{abiEvent:n,hash:ve(n),topics:Mt({abi:[n],args:e.filters})}}function $n(e){const{logs:t,events:n,strict:a}=e;return en({logs:t,abi:n.map(r=>r.abiEvent),strict:a})}function Nn(e){let t;return()=>(t||(t=e()),t)}const Hn="0x095ea7b3",jn=[{type:"address",name:"spender"},{type:"uint256",name:"value"}],zn=[{type:"bool"}];function Wn(e){const t=Nn(async()=>"asyncParams"in e?await e.asyncParams():e);return k({contract:e.contract,method:[Hn,jn,zn],params:async()=>{const n=await t();return[n.spender,n.value]},value:async()=>{var n;return(n=(await t()).overrides)==null?void 0:n.value},accessList:async()=>{var n;return(n=(await t()).overrides)==null?void 0:n.accessList},gas:async()=>{var n;return(n=(await t()).overrides)==null?void 0:n.gas},gasPrice:async()=>{var n;return(n=(await t()).overrides)==null?void 0:n.gasPrice},maxFeePerGas:async()=>{var n;return(n=(await t()).overrides)==null?void 0:n.maxFeePerGas},maxPriorityFeePerGas:async()=>{var n;return(n=(await t()).overrides)==null?void 0:n.maxPriorityFeePerGas},nonce:async()=>{var n;return(n=(await t()).overrides)==null?void 0:n.nonce},extraGas:async()=>{var n;return(n=(await t()).overrides)==null?void 0:n.extraGas},erc20Value:async()=>{var n;return(n=(await t()).overrides)==null?void 0:n.erc20Value}})}function kn(e){return Wn({contract:e.contract,asyncParams:async()=>{let t;if("amount"in e){const{decimals:n}=await P(()=>import("./decimals-52f99bc6.js"),["assets/decimals-52f99bc6.js","assets/index-3b8711e5.js","assets/index-e30b26c0.css","assets/detectExtension-c0bb3393.js"]),a=await n(e).catch(()=>18);t=Ye(e.amount.toString(),a)}else t=e.amountWei;return{spender:e.spender,value:t,overrides:{erc20Value:{amountWei:t,tokenAddress:e.contract.address}}}}})}function ce(e){return`0x${e.reduce((t,n)=>t+n.replace("0x",""),"")}`}const Zn=Object.freeze(Object.defineProperty({__proto__:null,concatHex:ce},Symbol.toStringTag,{value:"Module"}));function Qe(e){const t=e.domain;return(t==null?void 0:t.chainId)!==void 0&&ie(t.chainId)&&(e.domain={...e.domain,chainId:Gt(e.domain.chainId)}),e}const Yn="0xdd62ed3e",Xn=[{type:"address",name:"owner"},{type:"address",name:"spender"}],Kn=[{type:"uint256"}];async function Jn(e){return M({contract:e.contract,method:[Yn,Xn,Kn],params:[e.owner,e.spender]})}function N(e){if(["string","number"].includes(typeof e)&&!Number.isInteger(Number(e)))throw new Error(`Expected value to be an integer to convert to a bigint, got ${e} of type ${typeof e}`);return e instanceof Uint8Array?BigInt(vt(e)):BigInt(e)}const Ae=Zt*32n;class Qn extends C{constructor({givenLength:t,maxBytecodeSize:n}){super(`Bytecode cannot be longer than ${n} bytes. Given length: ${t}`,{name:"BytecodeLengthExceedsMaxSizeError"})}}class qn extends C{constructor({givenLengthInWords:t}){super(`Bytecode length in 32-byte words must be odd. Given length in words: ${t}`,{name:"BytecodeLengthInWordsMustBeOddError"})}}class ea extends C{constructor({givenLength:t}){super(`The bytecode length in bytes must be divisible by 32. Given length: ${t}`,{name:"BytecodeLengthMustBeDivisibleBy32Error"})}}function ta(e){const t=O(e);if(t.length%32!==0)throw new ea({givenLength:t.length});if(t.length>Ae)throw new Qn({givenLength:t.length,maxBytecodeSize:Ae});const n=Kt(t),a=O(n),r=t.length/32;if(r%2===0)throw new qn({givenLengthInWords:r});const s=O(r),i=I(s,{size:2}),o=new Uint8Array([1,0]);return a.set(o,0),a.set(i,2),a}const qe=50000n,na=e=>{const t=aa(e);return{domain:{name:"zkSync",version:"2",chainId:e.chainId},types:{Transaction:[{name:"txType",type:"uint256"},{name:"from",type:"uint256"},{name:"to",type:"uint256"},{name:"gasLimit",type:"uint256"},{name:"gasPerPubdataByteLimit",type:"uint256"},{name:"maxFeePerGas",type:"uint256"},{name:"maxPriorityFeePerGas",type:"uint256"},{name:"paymaster",type:"uint256"},{name:"nonce",type:"uint256"},{name:"value",type:"uint256"},{name:"data",type:"bytes"},{name:"factoryDeps",type:"bytes32[]"},{name:"paymasterInput",type:"bytes"}]},primaryType:"Transaction",message:t}};function aa(e){const{gas:t,nonce:n,to:a,from:r,value:s,maxFeePerGas:i,maxPriorityFeePerGas:o,paymaster:u,paymasterInput:c,gasPerPubdata:d,data:p,factoryDeps:y}=e;return{txType:113n,from:BigInt(r),to:a?BigInt(a):0n,gasLimit:t??0n,gasPerPubdataByteLimit:d??qe,maxFeePerGas:i??0n,maxPriorityFeePerGas:o??0n,paymaster:u?BigInt(u):0n,nonce:n?BigInt(n):0n,value:s??0n,data:p||"0x0",factoryDeps:(y==null?void 0:y.map(m=>x(ta(m))))??[],paymasterInput:c||"0x"}}async function ra(e){const{account:t,transaction:n}=e,a=await de(e),r=await ue({account:t,eip712Transaction:a,chainId:n.chain.id}),s=V(n);return{transactionHash:await ln(s,r),chain:n.chain,client:n.client}}async function ue(e){const{account:t,eip712Transaction:n,chainId:a}=e,r=na(n),s=await t.signTypedData({...r});return sa({...n,chainId:a,customSignature:s})}async function de(e){var y;const{account:t,transaction:n}=e;let[a,r,s,i,o,u,c]=await Promise.all([B(n),w(n.to),w(n.value),w(n.gas),w(n.maxFeePerGas),w(n.maxPriorityFeePerGas),w(n.eip712)]),d=c==null?void 0:c.gasPerPubdata;if(!i||!o||!u){const g=await V(n)({method:"zks_estimateFee",params:[{from:t.address,to:r,data:a,value:s?De(s):void 0,gasPerPubdata:d,eip712Meta:{...c,gasPerPubdata:d?x(d):x(50000n),factoryDeps:(y=c==null?void 0:c.factoryDeps)==null?void 0:y.map(l=>Array.from(Ie(l)))},type:"0x71"}]});i=N(g.gas_limit),o=N(g.max_fee_per_gas)*2n,u=N(g.max_priority_fee_per_gas)||1n,d=N(g.gas_per_pubdata_limit)*2n}return{...await Ke({transaction:{...n,gas:i,maxFeePerGas:o,maxPriorityFeePerGas:u},from:t.address}),...n.eip712,gasPerPubdata:d,from:t.address}}function sa(e){const{chainId:t,gas:n,nonce:a,to:r,from:s,value:i,maxFeePerGas:o,maxPriorityFeePerGas:u,customSignature:c,factoryDeps:d,paymaster:p,paymasterInput:y,gasPerPubdata:m,data:g}=e,f=[a?x(a):"0x",u?x(u):"0x",o?x(o):"0x",n?x(n):"0x",r??"0x",i?x(i):"0x",g??"0x0",x(t),x(""),x(""),x(t),s??"0x",m?x(m):x(qe),d??[],c??"0x",p&&y?[p,y]:[]];return ce(["0x71",Nt(f)])}const Qa=Object.freeze(Object.defineProperty({__proto__:null,populateEip712Transaction:de,sendEip712Transaction:ra,signEip712Transaction:ue},Symbol.toStringTag,{value:"Module"}));function ia(e){return e.id===324||e.id===300||e.id===302||e.id===11124||e.id===282||e.id===388}function oa(e={}){return Je({signature:"event UserOperationRevertReason(bytes32 indexed userOpHash, address indexed sender, uint256 nonce, bytes revertReason)",filters:e})}function ca(e={}){return Je({signature:"event PostOpRevertReason(bytes32 indexed userOpHash, address indexed sender, uint256 nonce, bytes revertReason)",filters:e})}function ua(e){const{receipt:t}=e,n={...t,transactionHash:t.transactionHash,blockNumber:t.blockNumber?BigInt(t.blockNumber):null,contractAddress:t.contractAddress?t.contractAddress:null,cumulativeGasUsed:t.cumulativeGasUsed?BigInt(t.cumulativeGasUsed):null,effectiveGasPrice:t.effectiveGasPrice?BigInt(t.effectiveGasPrice):null,gasUsed:t.gasUsed?BigInt(t.gasUsed):null,logs:t.logs,to:t.to?t.to:null,transactionIndex:t.transactionIndex,status:t.status,type:t.type};return t.blobGasPrice&&(n.blobGasPrice=BigInt(t.blobGasPrice)),t.blobGasUsed&&(n.blobGasUsed=BigInt(t.blobGasUsed)),{...e,receipt:n,userOpHash:e.userOpHash,actualGasCost:BigInt(e.actualGasCost),actualGasUsed:BigInt(e.actualGasUsed),nonce:BigInt(e.nonce)}}const da=()=>{const e=BigInt(Math.floor(Math.random()*4294967296)),t=BigInt(Math.floor(Math.random()*4294967296)),n=BigInt(Math.floor(Math.random()*4294967296)),a=BigInt(Math.floor(Math.random()*4294967296)),r=BigInt(Math.floor(Math.random()*4294967296)),s=BigInt(Math.floor(Math.random()*4294967296));return e<<BigInt(160)|t<<BigInt(128)|n<<BigInt(96)|a<<BigInt(64)|r<<BigInt(32)|s};function le(e){return Object.fromEntries(Object.entries(e).map(([t,n])=>[t,n==null||ie(n)?n:x(n)]))}async function la(e){return S({...e,operation:"eth_sendUserOperation",params:[le(e.userOp),e.options.entrypointAddress??T]})}async function H(e){const t=await S({...e,operation:"eth_estimateUserOperationGas",params:[le(e.userOp),e.options.entrypointAddress??T]});return{preVerificationGas:A(t.preVerificationGas),verificationGas:A(t.verificationGas),verificationGasLimit:A(t.verificationGasLimit),callGasLimit:A(t.callGasLimit)+_t,paymasterVerificationGasLimit:t.paymasterVerificationGasLimit!==void 0?A(t.paymasterVerificationGasLimit):void 0,paymasterPostOpGasLimit:t.paymasterPostOpGasLimit!==void 0?A(t.paymasterPostOpGasLimit):void 0}}async function pa(e){const t=await S({...e,operation:"thirdweb_getUserOperationGasPrice",params:[]});return{maxPriorityFeePerGas:A(t.maxPriorityFeePerGas),maxFeePerGas:A(t.maxFeePerGas)}}async function fa(e){var n,a;const t=await ya(e);if(t){if(t.success===!1){const s=(a=(n=$n({events:[oa(),ca()],logs:t.logs})[0])==null?void 0:n.args)==null?void 0:a.revertReason;if(!s)throw new Error(`UserOp failed at txHash: ${t.receipt.transactionHash}`);const i=Ve({data:s});throw new Error(`UserOp failed with reason: '${i.args.join(",")}' at txHash: ${t.receipt.transactionHash}`)}return t.receipt}}async function ya(e){const t=await S({options:e,operation:"eth_getUserOperationReceipt",params:[e.userOpHash]});if(t)return ua(t)}async function ma(e){const t=await S({options:e.options,operation:"zk_paymasterData",params:[e.transaction]});return{paymaster:t.paymaster,paymasterInput:t.paymasterInput}}async function ga(e){return{transactionHash:(await S({options:e.options,operation:"zk_broadcastTransaction",params:[{...e.transaction,signedTransaction:e.signedTransaction}]})).transactionHash}}async function S(e){const{options:t,operation:n,params:a}=e,s=R(t.entrypointAddress||T)==="v0.6"?"v1":"v2",i=t.bundlerUrl??oe(t.chain,s),u=await z(t.client)(i,{method:"POST",headers:{"Content-Type":"application/json"},body:Be({jsonrpc:"2.0",id:1,method:n,params:a})}),c=await u.json();if(!u.ok||c.error){let d=c.error||u.statusText;typeof d=="object"&&(d=JSON.stringify(d));const p=c.code||"UNKNOWN";throw new Error(`${n} error: ${d}
Status: ${u.status}
Code: ${p}`)}return c.result}async function ha(e){const{factoryContract:t,predictAddressOverride:n,adminAddress:a,accountSalt:r,accountAddress:s}=e;if(n)return n(t);if(s)return s;if(!a)throw new Error("Account address is required to predict the smart wallet address.");const i=Se(r??"");return M({contract:t,method:"function getAddress(address, bytes) returns (address)",params:[a,i]})}function et(e){const{adminAddress:t,factoryContract:n,createAccountOverride:a,accountSalt:r}=e;return a?a(n):k({contract:n,method:"function createAccount(address, bytes) returns (address)",params:[t,Se(r??"")]})}function tt(e){const{accountContract:t,transaction:n,executeOverride:a}=e;return a?a(t,n):k({contract:t,method:"function execute(address, uint256, bytes)",params:[n.to||"",n.value||0n,n.data||"0x"]})}function Pa(e){const{accountContract:t,transactions:n,executeBatchOverride:a}=e;return a?a(t,n):k({contract:t,method:"function executeBatch(address[], uint256[], bytes[])",params:[n.map(r=>r.to||""),n.map(r=>r.value||0n),n.map(r=>r.data||"0x")]})}const ba="0x35567e1a",wa=[{type:"address",name:"sender"},{type:"uint192",name:"key"}],xa=[{type:"uint256",name:"nonce"}];async function Aa(e){return M({contract:e.contract,method:[ba,wa,xa],params:[e.sender,e.key]})}const Ga="0xa6193531",va=[{type:"tuple",name:"userOp",components:[{type:"address",name:"sender"},{type:"uint256",name:"nonce"},{type:"bytes",name:"initCode"},{type:"bytes",name:"callData"},{type:"uint256",name:"callGasLimit"},{type:"uint256",name:"verificationGasLimit"},{type:"uint256",name:"preVerificationGas"},{type:"uint256",name:"maxFeePerGas"},{type:"uint256",name:"maxPriorityFeePerGas"},{type:"bytes",name:"paymasterAndData"},{type:"bytes",name:"signature"}]}],_a=[{type:"bytes32"}];async function Ta(e){return M({contract:e.contract,method:[Ga,va,_a],params:[e.userOp]})}const Ea="0x22cdde4c",Ia=[{type:"tuple",name:"userOp",components:[{type:"address",name:"sender"},{type:"uint256",name:"nonce"},{type:"bytes",name:"initCode"},{type:"bytes",name:"callData"},{type:"bytes32",name:"accountGasLimits"},{type:"uint256",name:"preVerificationGas"},{type:"bytes32",name:"gasFees"},{type:"bytes",name:"paymasterAndData"},{type:"bytes",name:"signature"}]}],Oa=[{type:"bytes32"}];async function La(e){return M({contract:e.contract,method:[Ea,Ia,Oa],params:[e.userOp]})}function Da(e){return e.factory?F([e.factory,e.factoryData||"0x"]):"0x"}function Fa(e){return F([I(_(e.verificationGasLimit),{size:16}),I(_(e.callGasLimit),{size:16})])}function Ba(e){return F([I(_(e.maxPriorityFeePerGas),{size:16}),I(_(e.maxFeePerGas),{size:16})])}function Sa(e){return e.paymaster?F([e.paymaster,I(_(e.paymasterVerificationGasLimit||BigInt(0)),{size:16}),I(_(e.paymasterPostOpGasLimit||BigInt(0)),{size:16}),e.paymasterData||"0x"]):"0x"}const Ua=e=>({sender:e.sender,nonce:e.nonce,initCode:Da(e),callData:e.callData,accountGasLimits:Fa(e),preVerificationGas:e.preVerificationGas,gasFees:Ba(e),paymasterAndData:Sa(e),signature:e.signature});async function j(e){var f;const{userOp:t,paymasterOverride:n,client:a,chain:r,entrypointAddress:s}=e;if(n)return n(t);const i={"Content-Type":"application/json"},o=s??T,c=R(o)==="v0.6"?"v1":"v2",d=oe(r,c),y=await z(a)(d,{method:"POST",headers:i,body:JSON.stringify({jsonrpc:"2.0",id:1,method:"pm_sponsorUserOperation",params:[le(t),o]})}),m=await y.json();if(!y.ok){const l=m.error||y.statusText,h=m.code||"UNKNOWN";throw new Error(`Paymaster error: ${l}
Status: ${y.status}
Code: ${h}`)}if(m.result)return typeof m.result=="string"?{paymasterAndData:m.result}:{paymasterAndData:m.result.paymasterAndData,verificationGasLimit:m.result.verificationGasLimit?A(m.result.verificationGasLimit):void 0,preVerificationGas:m.result.preVerificationGas?A(m.result.preVerificationGas):void 0,callGasLimit:m.result.callGasLimit?A(m.result.callGasLimit):void 0,paymaster:m.result.paymaster,paymasterData:m.result.paymasterData,paymasterVerificationGasLimit:m.result.paymasterVerificationGasLimit?A(m.result.paymasterVerificationGasLimit):void 0,paymasterPostOpGasLimit:m.result.paymasterPostOpGasLimit?A(m.result.paymasterPostOpGasLimit):void 0};const g=((f=m.error)==null?void 0:f.message)||m.error||y.statusText||"unknown error";throw new Error(`Paymaster error from ${d}: ${g}`)}const pe=new Set,fe=e=>`${e.chain.id}:${e.address}`,nt=e=>{pe.add(fe(e))},Ca=e=>{pe.delete(fe(e))},ye=e=>pe.has(fe(e));async function Va(e){const t=e.timeoutMs||12e4,n=e.intervalMs||1e3,a=Date.now()+t;for(;Date.now()<a;){const r=await fa(e);if(r)return r;await new Promise(s=>setTimeout(s,n))}throw new Error("Timeout waiting for userOp to be mined")}async function Ma(e){var h;const{transaction:t,accountContract:n,factoryContract:a,adminAddress:r,overrides:s,sponsorGas:i}=e,o=t.chain,u=t.client,c={client:u,chain:o,entrypointAddress:s==null?void 0:s.entrypointAddress},d=R(((h=e.overrides)==null?void 0:h.entrypointAddress)||T),[p,y,m,g]=await Promise.all([Tt(n),B(t),Ra({executeTx:t,bundlerOptions:c,chain:o,client:u}),za({accountContract:n,chain:o,client:u,entrypointAddress:s==null?void 0:s.entrypointAddress,getNonceOverride:s==null?void 0:s.getAccountNonce})]),{maxFeePerGas:f,maxPriorityFeePerGas:l}=m;return d==="v0.7"?$a({bundlerOptions:c,factoryContract:a,accountContract:n,adminAddress:r,sponsorGas:i,overrides:s,isDeployed:p,nonce:g,callData:y,maxFeePerGas:f,maxPriorityFeePerGas:l}):Na({bundlerOptions:c,factoryContract:a,accountContract:n,adminAddress:r,sponsorGas:i,overrides:s,isDeployed:p,nonce:g,callData:y,maxFeePerGas:f,maxPriorityFeePerGas:l})}async function Ra(e){const{executeTx:t,bundlerOptions:n,chain:a,client:r}=e;let{maxFeePerGas:s,maxPriorityFeePerGas:i}=t;const u=R(n.entrypointAddress||T)==="v0.6"?"v1":"v2",c=(n==null?void 0:n.bundlerUrl)??oe(a,u);if(Et(c)){const d=await pa({options:n});s=d.maxFeePerGas,i=d.maxPriorityFeePerGas}else{const[d,p]=await Promise.all([w(s),w(i)]);if(d&&p)s=d,i=p;else{const y=await Xe(r,a);i=p??y.maxPriorityFeePerGas??0n,s=d??y.maxFeePerGas??0n}}return{maxFeePerGas:s,maxPriorityFeePerGas:i}}async function $a(e){const{bundlerOptions:t,isDeployed:n,factoryContract:a,accountContract:r,adminAddress:s,sponsorGas:i,overrides:o,nonce:u,callData:c,maxFeePerGas:d,maxPriorityFeePerGas:p}=e,{chain:y,client:m}=t;let g,f;n||ye(r)?(f="0x",await at(r)):(g=a.address,f=await B(et({factoryContract:a,adminAddress:s,accountSalt:o==null?void 0:o.accountSalt,createAccountOverride:o==null?void 0:o.createAccount})),nt(r));const l={sender:r.address,nonce:u,callData:c,maxFeePerGas:d,maxPriorityFeePerGas:p,callGasLimit:0n,verificationGasLimit:0n,preVerificationGas:0n,factory:g,factoryData:f,paymaster:void 0,paymasterData:"0x",paymasterVerificationGasLimit:0n,paymasterPostOpGasLimit:0n,signature:Ue};if(i){const h=await j({userOp:l,chain:y,client:m,entrypointAddress:o==null?void 0:o.entrypointAddress,paymasterOverride:o==null?void 0:o.paymaster});if(h.paymaster&&h.paymasterData&&(l.paymaster=h.paymaster,l.paymasterData=h.paymasterData),h.callGasLimit&&h.verificationGasLimit&&h.preVerificationGas&&h.paymasterPostOpGasLimit&&h.paymasterVerificationGasLimit)l.callGasLimit=h.callGasLimit,l.verificationGasLimit=h.verificationGasLimit,l.preVerificationGas=h.preVerificationGas,l.paymasterPostOpGasLimit=h.paymasterPostOpGasLimit,l.paymasterVerificationGasLimit=h.paymasterVerificationGasLimit;else{const b=await H({userOp:l,options:t});l.callGasLimit=b.callGasLimit,l.verificationGasLimit=b.verificationGasLimit,l.preVerificationGas=b.preVerificationGas,l.paymasterPostOpGasLimit=h.paymasterPostOpGasLimit||0n,l.paymasterVerificationGasLimit=h.paymasterVerificationGasLimit||0n;const E=await j({userOp:l,chain:y,client:m,entrypointAddress:o==null?void 0:o.entrypointAddress,paymasterOverride:o==null?void 0:o.paymaster});E.paymaster&&E.paymasterData&&(l.paymaster=E.paymaster,l.paymasterData=E.paymasterData)}}else{const h=await H({userOp:l,options:t});l.callGasLimit=h.callGasLimit,l.verificationGasLimit=h.verificationGasLimit,l.preVerificationGas=h.preVerificationGas,l.paymasterPostOpGasLimit=h.paymasterPostOpGasLimit||0n,l.paymasterVerificationGasLimit=h.paymasterVerificationGasLimit||0n}return{...l,signature:"0x"}}async function Na(e){const{bundlerOptions:t,isDeployed:n,factoryContract:a,accountContract:r,adminAddress:s,sponsorGas:i,overrides:o,nonce:u,callData:c,maxFeePerGas:d,maxPriorityFeePerGas:p}=e,{chain:y,client:m}=t;let g;n||ye(r)?(g="0x",await at(r)):(g=await ja({factoryContract:a,adminAddress:s,accountSalt:o==null?void 0:o.accountSalt,createAccountOverride:o==null?void 0:o.createAccount}),nt(r));const f={sender:r.address,nonce:u,initCode:g,callData:c,maxFeePerGas:d,maxPriorityFeePerGas:p,callGasLimit:0n,verificationGasLimit:0n,preVerificationGas:0n,paymasterAndData:"0x",signature:Ue};if(i){const l=await j({userOp:f,chain:y,client:m,entrypointAddress:o==null?void 0:o.entrypointAddress,paymasterOverride:o==null?void 0:o.paymaster}),h="paymasterAndData"in l?l.paymasterAndData:"0x";if(h&&h!=="0x"&&(f.paymasterAndData=h),l.callGasLimit&&l.verificationGasLimit&&l.preVerificationGas)f.callGasLimit=l.callGasLimit,f.verificationGasLimit=l.verificationGasLimit,f.preVerificationGas=l.preVerificationGas;else{const b=await H({userOp:f,options:t});if(f.callGasLimit=b.callGasLimit,f.verificationGasLimit=b.verificationGasLimit,f.preVerificationGas=b.preVerificationGas,h&&h!=="0x"){const E=await j({userOp:f,chain:y,client:m,entrypointAddress:o==null?void 0:o.entrypointAddress,paymasterOverride:o==null?void 0:o.paymaster}),Z="paymasterAndData"in E?E.paymasterAndData:"0x";Z&&Z!=="0x"&&(f.paymasterAndData=Z)}}}else{const l=await H({userOp:f,options:t});f.callGasLimit=l.callGasLimit,f.verificationGasLimit=l.verificationGasLimit,f.preVerificationGas=l.preVerificationGas}return{...f,signature:"0x"}}async function Ha(e){const{userOp:t,chain:n,entrypointAddress:a,adminAccount:r}=e,s=R(a||T);let i;if(s==="v0.7"){const o=Ua(t);i=await La({contract:D({address:a||It,chain:n,client:e.client}),userOp:o})}else i=await Ta({contract:D({address:a||T,chain:n,client:e.client}),userOp:t});if(r.signMessage){const o=await r.signMessage({message:{raw:Ot(i)}});return{...t,signature:o}}throw new Error("signMessage not implemented in signingAccount")}async function ja(e){const{factoryContract:t,adminAddress:n,accountSalt:a,createAccountOverride:r}=e,s=et({factoryContract:t,adminAddress:n,accountSalt:a,createAccountOverride:r});return F([t.address,await B(s)])}async function za(e){const{accountContract:t,chain:n,client:a,entrypointAddress:r,getNonceOverride:s}=e;return s?s(t):Aa({contract:D({address:r||T,chain:n,client:a}),key:da(),sender:t.address})}async function at(e){const t=Date.now();for(;ye(e);){if(Date.now()-t>6e4)throw new Error("Account deployment is taking too long (over 1 minute). Please try again.");await new Promise(n=>setTimeout(n,500))}}function Wa(e){return e.id==="smart"}const rt=new WeakMap,te=new WeakMap;async function ka(e,t,n){var g,f,l,h;const{personalAccount:a,client:r,chain:s}=t;if(!a)throw new Error("Personal wallet does not have an account");const i=n,o=i.factoryAddress??Lt((g=n.overrides)==null?void 0:g.entrypointAddress),u=s??i.chain,c="gasless"in i?i.gasless:i.sponsorGas;if(ia(u))return[Ka({creationOptions:n,connectionOptions:t,chain:u,sponsorGas:c}),u];const d=D({client:r,address:o,chain:u}),p=await ha({factoryContract:d,adminAddress:a.address,predictAddressOverride:(f=i.overrides)==null?void 0:f.predictAddress,accountSalt:(l=i.overrides)==null?void 0:l.accountSalt,accountAddress:(h=i.overrides)==null?void 0:h.accountAddress}).then(b=>b).catch(b=>{throw new Error(`Failed to get account address with factory contract ${d.address} on chain ID ${u.id}: ${(b==null?void 0:b.message)||"unknown error"}`,{cause:b})}),y=D({client:r,address:p,chain:u}),m=await Ya({...i,chain:u,sponsorGas:c,personalAccount:a,accountContract:y,factoryContract:d,client:r});return rt.set(a,e),te.set(e,a),[m,u]}async function Za(e){const t=te.get(e);t&&(rt.delete(t),te.delete(e))}async function Ya(e){const{accountContract:t}=e,n={address:Dt(t.address),async sendTransaction(a){var o,u,c;const r=(o=e.overrides)==null?void 0:o.erc20Paymaster;let s;if(r){await Xa({accountContract:t,erc20Paymaster:r,options:e});const d=async()=>({paymasterAndData:ce([r.address,r==null?void 0:r.token]),paymaster:r.address,paymasterData:"0x"});s=((u=e.overrides)==null?void 0:u.paymaster)||d}const i=tt({accountContract:t,transaction:a,executeOverride:(c=e.overrides)==null?void 0:c.execute});return ne({executeTx:i,options:{...e,overrides:{...e.overrides,paymaster:s}}})},async sendBatchTransaction(a){var s;const r=Pa({accountContract:t,transactions:a,executeBatchOverride:(s=e.overrides)==null?void 0:s.executeBatch});return ne({executeTx:r,options:e})},async signMessage({message:a}){const[{isContractDeployed:r},{readContract:s},{encodeAbiParameters:i},{hashMessage:o},{checkContractWalletSignature:u}]=await Promise.all([P(()=>import("./index-3b8711e5.js").then(g=>g.fY),["assets/index-3b8711e5.js","assets/index-e30b26c0.css"]),P(()=>import("./index-3b8711e5.js").then(g=>g.fX),["assets/index-3b8711e5.js","assets/index-e30b26c0.css"]),P(()=>import("./index-3b8711e5.js").then(g=>g.fW),["assets/index-3b8711e5.js","assets/index-e30b26c0.css"]),P(()=>import("./hashMessage-e1cadf79.js"),["assets/hashMessage-e1cadf79.js","assets/index-3b8711e5.js","assets/index-e30b26c0.css"]),P(()=>import("./checkContractWalletSignature-65194a19.js"),["assets/checkContractWalletSignature-65194a19.js","assets/isValidSignature-602a88bc.js","assets/index-3b8711e5.js","assets/index-e30b26c0.css"])]);await r(t)||await Ge({options:e,account:n,accountContract:t});const d=o(a);let p=!1;try{await s({contract:t,method:"function getMessageHash(bytes32 _hash) public view returns (bytes32)",params:[d]}),p=!0}catch{}let y;if(p){const g=i([{type:"bytes32"}],[d]);y=await e.personalAccount.signTypedData({domain:{name:"Account",version:"1",chainId:e.chain.id,verifyingContract:t.address},primaryType:"AccountMessage",types:{AccountMessage:[{name:"message",type:"bytes"}]},message:{message:g}})}else y=await e.personalAccount.signMessage({message:a});if(await u({contract:t,message:a,signature:y}))return y;throw new Error("Unable to verify signature on smart account, please make sure the smart account is deployed and the signature is valid.")},async signTypedData(a){var f,l,h;const r=Qe(a),[{isContractDeployed:s},{readContract:i},{encodeAbiParameters:o},{checkContractWalletSignedTypedData:u}]=await Promise.all([P(()=>import("./index-3b8711e5.js").then(b=>b.fY),["assets/index-3b8711e5.js","assets/index-e30b26c0.css"]),P(()=>import("./index-3b8711e5.js").then(b=>b.fX),["assets/index-3b8711e5.js","assets/index-e30b26c0.css"]),P(()=>import("./index-3b8711e5.js").then(b=>b.fW),["assets/index-3b8711e5.js","assets/index-e30b26c0.css"]),P(()=>import("./checkContractWalletSignedTypedData-78d1dd54.js"),["assets/checkContractWalletSignedTypedData-78d1dd54.js","assets/isValidSignature-602a88bc.js","assets/index-3b8711e5.js","assets/index-e30b26c0.css"])]);if(((l=(f=r.domain)==null?void 0:f.verifyingContract)==null?void 0:l.toLowerCase())===((h=t.address)==null?void 0:h.toLowerCase()))return e.personalAccount.signTypedData(r);await s(t)||await Ge({options:e,account:n,accountContract:t});const p=nn(r);let y=!1;try{await i({contract:t,method:"function getMessageHash(bytes32 _hash) public view returns (bytes32)",params:[p]}),y=!0}catch{}let m;if(y){const b=o([{type:"bytes32"}],[p]);m=await e.personalAccount.signTypedData({domain:{name:"Account",version:"1",chainId:e.chain.id,verifyingContract:t.address},primaryType:"AccountMessage",types:{AccountMessage:[{name:"message",type:"bytes"}]},message:{message:b}})}else m=await e.personalAccount.signTypedData(r);if(await u({contract:t,data:r,signature:m}))return m;throw new Error("Unable to verify signature on smart account, please make sure the smart account is deployed and the signature is valid.")},async onTransactionRequested(a){var r,s;return(s=(r=e.personalAccount).onTransactionRequested)==null?void 0:s.call(r,a)}};return n}async function Xa(e){var d;const{accountContract:t,erc20Paymaster:n,options:a}=e,r=n.token,s=D({address:r,chain:t.chain,client:t.client});if(await Jn({contract:s,owner:t.address,spender:n.address})>0n)return;const o=kn({contract:s,spender:n.address,amountWei:Yt-1n}),u=await Ke({transaction:o,from:t.address}),c=tt({accountContract:t,transaction:u,executeOverride:(d=a.overrides)==null?void 0:d.execute});await ne({executeTx:c,options:{...a,overrides:{...a.overrides,erc20Paymaster:void 0}}})}function Ka(e){const{creationOptions:t,connectionOptions:n,chain:a}=e,r={address:n.personalAccount.address,async sendTransaction(s){var d,p,y,m;const i={data:s.data,to:s.to??void 0,value:s.value??0n,chain:Ft(s.chainId),client:n.client};let o=await de({account:r,transaction:i});if(e.sponsorGas){const g=await ma({options:{client:n.client,chain:a,bundlerUrl:(d=t.overrides)==null?void 0:d.bundlerUrl,entrypointAddress:(p=t.overrides)==null?void 0:p.entrypointAddress},transaction:o});o={...o,...g}}const u=await ue({account:r,chainId:a.id,eip712Transaction:o});return{transactionHash:(await ga({options:{client:n.client,chain:a,bundlerUrl:(y=t.overrides)==null?void 0:y.bundlerUrl,entrypointAddress:(m=t.overrides)==null?void 0:m.entrypointAddress},transaction:o,signedTransaction:u})).transactionHash,client:n.client,chain:a}},async signMessage({message:s}){return n.personalAccount.signMessage({message:s})},async signTypedData(s){const i=Qe(s);return n.personalAccount.signTypedData(i)},async onTransactionRequested(s){var i,o;return(o=(i=n.personalAccount).onTransactionRequested)==null?void 0:o.call(i,s)}};return r}async function Ge(e){const{options:t,account:n,accountContract:a}=e,[{sendTransaction:r},{prepareTransaction:s}]=await Promise.all([P(()=>import("./send-transaction-24c135b0.js").then(u=>u.s),["assets/send-transaction-24c135b0.js","assets/index-3b8711e5.js","assets/index-e30b26c0.css"]),P(()=>Promise.resolve().then(()=>pn),void 0)]),i=s({client:t.client,chain:t.chain,to:a.address,value:0n,gas:50000n});return await r({transaction:i,account:n})}async function ne(e){var u,c,d;const{executeTx:t,options:n}=e,a=await Ma({transaction:t,factoryContract:n.factoryContract,accountContract:n.accountContract,adminAddress:n.personalAccount.address,sponsorGas:n.sponsorGas,overrides:n.overrides}),r=await Ha({client:n.client,chain:n.chain,adminAccount:n.personalAccount,entrypointAddress:(u=n.overrides)==null?void 0:u.entrypointAddress,userOp:a}),s={chain:n.chain,client:n.client,bundlerUrl:(c=n.overrides)==null?void 0:c.bundlerUrl,entrypointAddress:(d=n.overrides)==null?void 0:d.entrypointAddress},i=await la({options:s,userOp:r}),o=await Va({...n,userOpHash:i});return Ca(n.accountContract),{client:n.client,chain:n.chain,transactionHash:o.transactionHash}}const qa=Object.freeze(Object.defineProperty({__proto__:null,connectSmartWallet:ka,disconnectSmartWallet:Za,isSmartWallet:Wa},Symbol.toStringTag,{value:"Module"}));export{nn as h,qa as i,Qa as s,Ke as t};
